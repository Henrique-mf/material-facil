<!-- HTML structure -->
<div class="button-container">
  <%= link_to "Schools", schools_path, class: "btn btn-info product" %>
  <!-- <%= link_to "Products", products_path, class: "btn btn-info categories" %> -->
  <%= link_to "Categories", categories_path, class: "btn btn-info categories" %>
  <!-- Top horizontal menu -->
  <% @categories = Category.all %>
  <% @categories.each do |category| %>
    <%= link_to category.name, category_path(category), class: "btn btn-info categories" %>
  <% end %>
</div>

<div class="search-address-container btn btn-info">
  <button id="select-address-button">Select delivery address</button>
  <div id="delivery-address"></div>
</div>

<%= render "shared/carrousel" %>

<% @categories.each do |category| %>
  <div class="sub-categories-name">
    <%= link_to category.name, category_path(category) %>
  </div>

  <!-- Product Grid -->
  <div class="product-grid">
    <% @products = category.products.limit(4) %>
    <% @products.each do |product| %>
      <!-- Product Card -->
      <div class="product-card">
        <!-- Product Image -->
        <div class="product-image-container">
          <% if product.photo.key? %>
            <%= cl_image_tag product.photo.key, class: "product-image" %>
          <% else %>
            <%= image_tag "product_placeholder.png", class: "product-image" %>
          <% end %>
        </div>
        <!-- Product Details -->
        <div class="product-info">
          <h2><%= product.name %></h2>
          <!-- Truncated Description -->
          <div class="product-description">
            <%= product.description %>
          </div>
          <!-- Read More Link -->
          <a href="#" class="read-more-link">Read More</a>
          <h1> <%= humanized_money_with_symbol(product.price) %></h1>
          <%= link_to "View Details", product_path(product), class: "btn btn-primary" %>
        </div>
      </div>
    <% end %>
  </div>
<% end %>

<!-- JS script for address search -->
<script>
document.addEventListener('DOMContentLoaded', function () {
  const selectAddressButton = document.getElementById('select-address-button');
  const deliveryAddress = document.getElementById('delivery-address');

  selectAddressButton.addEventListener('click', function () {
    if (selectAddressButton.textContent === 'Select delivery address') {
      // Display the input field for zip code.
      selectAddressButton.textContent = 'Submit Zip Code';
      deliveryAddress.innerHTML = '<input type="text" id="zip-code-input" placeholder="Enter Zip Code">';
    } else {
      // Handle zip code submission here.
      const zipCodeInput = document.getElementById('zip-code-input');
      const zipCode = zipCodeInput.value;

      // Perform geocoding request and update button label with the delivery address.
      fetch(`/geocode?zip_code=${zipCode}`)
        .then(response => response.json())
        .then(data => {
          if (data.error) {
            deliveryAddress.textContent = 'Error: ' + data.error;
          } else {
            deliveryAddress.textContent = 'Delivering to ' + data.address;
            selectAddressButton.style.display = 'none'; // Hide the button after setting the address.
          }
        })
        .catch(error => {
          deliveryAddress.textContent = 'An error occurred: ' + error.message;
        });
    }
  });
});
</script>
